<!-- <header class="navbar-fixed"> -->
<!-- 
    TODO: 漲跌幅還沒做
    TODO: US 10 Yr 還沒做，抓不到。
    TODO: 區塊高度還沒做，不知道這是什麼
 -->
 <header class="navbar">
    <nav id="headNav" class="bg-color nav-transparent">
        <div class="bitcoin-price">
            <div class="btc-price black">
                <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

                <div class="container">
                    <script>
                        // get exchange data from a self-hosted api to get data from ftx, binance...etc
                        // get specific crypto data
                        async function getData(){
                            // 不用這樣~ 我們不需要傳入東西，彈藥回傳十筆來處理，所以我們必須先定義一個list
                            // 然後把後端回傳回來的十筆值給塞進來那個變數
                                                  
                            let data;
                            let url = "<%- theme.stock.getCryptoUrl%>"+'coin=BTC/USDT';
                            // url need to be changed
                            await axios.get(url)
                            .then((response) => {
                                data = JSON.parse(JSON.stringify(response.data));
                            })
                            .catch((error) => {
                                data = error;
                                console.log(error);
                            });
                            return data;
                        }
                        
                        // get exchange data from a self-hosted api to get data from ftx, binance...etc
                        // get specific stock data
                        // async function getStock(query, type, exchange){
                        //     let data;
                        //     let url = "<%- theme.stock.getStockUrl%>" +'query=' + query + '&type=' + type + '&exchange=' + exchange;
                        //     // url need to be changed
                        //     await axios.get(url)
                        //     .then((response) => {
                        //         data = JSON.parse(JSON.stringify(response.data));
                        //     })
                        //     .catch((error) => {
                        //         data = error;
                        //         console.log(error);
                        //     });
                        //     return data;
                        // }

                        async function getStock(){
                            let data;
                            let url = "<%- theme.stock.getStockUrl%>";
                            // url need to be changed
                            await axios.get(url)
                            .then((response) => {
                                data = response.data;
                                // data = JSON.parse(JSON.stringify(response.data));
                            })
                            .catch((error) => {
                                data = error;
                                console.log(error);
                            });
                            return data;
                        }
                        
                        // get exchange data from a self-hosted api to get data from ftx, binance...etc
                        // get specific stock gain
                        async function getStockGain(query, type, exchange){
                            let data;
                            let url = "<%- theme.stock.getStockGainUrl%>" + 'query=' + query + '&type=' + type + '&exchange=' + exchange;
                            // url need to be changed
                            await axios.get(url)
                            .then((response) => {
                                data = JSON.parse(JSON.stringify(response.data));
                            })
                            .catch((error) => {
                                data = error;
                                console.log(error);
                            });
                            return data;
                        }

                        function setPriceGain(imgID, textID, gainID, data){
                            if (data > 0){
                                document.getElementById(imgID).classList.add("fa-caret-up");
                                document.getElementById(imgID).classList.add("green-text");
                                document.getElementById(textID).classList.add("green-text");
                            } else if (data == 0){

                            } else {
                                document.getElementById(imgID).classList.add("fa-caret-down");
                                document.getElementById(imgID).classList.add("red-text");
                                document.getElementById(textID).classList.add("red-text");
                                data *= -1;
                            }
                            document.getElementById(gainID).innerHTML = data + "%";
                        }
                    </script>
                    
                    <img src="<%- theme.jsDelivr.url %><%- url_for(theme.iconCal) %>" class="responsive-img" alt="iconCal">
                    <span><%- date(Date.now(), 'YYYY/M/D') %></span>
                    <span id="header_cropto_name">
                        
                        <!-- needed to be able to change -->
                        <!-- send data to js and call api -->
                        <!-- BTC/USDT -->
                        <script> 
                            getData().then( res => {
                                // if the api is not working, show error message
                                let nameMsg = res.message === "Network Error" ? "<%- theme.stock.apiErrMsg%>" : res.result.name;
                                // if the api is working, show the name
                                document.getElementById("header_cropto_name").innerHTML = "BTC";
                            }); 
                        </script>
                    </span>
                    <img src="<%- theme.jsDelivr.url %><%- url_for(theme.iconMoney) %>" class="responsive-img" alt="iconMoney">
                    <span>價格：
                        <span id="header_crypto_price">
                            <script>
                                // get data from the func "getData"
                                getData().then( res => {
                                    // if the api is not connected, show the error msg
                                    let priceMsg = res.message === "Network Error" ? "<%- theme.stock.apiErrMsg%>"  : res.result.price;
                                    // show the price
                                    document.getElementById("header_crypto_price").innerHTML = priceMsg;
                                }); 
                            </script>
                        </span>
                    </span>
                    <span>|</span>
                    <img src="<%- theme.jsDelivr.url %><%- url_for(theme.iconBlock) %>" class="responsive-img" alt="iconBlock">
                    <span>區塊高度：
                        <span id="header_crypto_blockhigh">
                            <script>
                                // get data from the func "getData"
                                getData().then( res => {
                                    // if the api is not connected, show the error msg
                                    let blockhighMsg = res.message === "Network Error" ? "<%- theme.stock.apiErrMsg%>"  : "757,674"; //res.result.區塊高度;
                                    // show the blockhigh
                                    document.getElementById("header_crypto_blockhigh").innerHTML = blockhighMsg;
                                });
                            </script>
                        </span>
                    </span>
                </div>
            </div>
            <div class="stock-price grey lighten-4">
                <div class="swiper-container" style="height: 60px;">
                    <div class="swiper mySwiper2">
                        <div class="swiper-wrapper">
                            <!-- 不用~ 我們只要讓他自動生成就好了  -->
                            <!-- 當然不是~ 寫這樣而已w -->
                            <!-- get data from api by ejs axio -->
                            
                            <% for (var i =1; i <=10;  i++ ) { %>
                                <div class="swiper-slide">
                                    <div id="name-<%= i %>" style="height: 20px;">name</div>
                                    <span id="price-<%= i %>">price</span>
                                    <i id="price-<%= i %>_gain_img" class="fa-solid text-darken-3 "></i> 
                                    <span id="price-<%= i %>_gain_text" class="text-darken-3"> 
                                        <span id="price-<%= i %>_gain"></span>
                                    </span>
                                </div>                                                            
                            <% } %>
                            <script>
                                // TODO: 把 nav bar三組改成一組
                                // TODO: 解決有些 index 無法連動的問題
                                // TODO: 新增漲跌幅
                                getStock().then( res => {
                                    var i = 1
                                    for (var item = 0; item <= res.length; item++){
                                        // console.log("price-"+i.toString())
                                        console.log(res[item])
                                        document.getElementById("name-"+i.toString()).innerHTML = res[item]["name"]
                                        document.getElementById("price-"+i.toString()).innerHTML = res[item]["price"]
                                        setPriceGain("price-" + i.toString() + "_gain_img", "price-" + i.toString() + "_gain_text", "price-" + i.toString() + "_gain", parseFloat(res[item]["gain"]));                                
                                        i++
                                    }
                                    // document.getElementById("header_US500_price").innerHTML = data;
                                });
                            </script>                                                                               
                        </div>                        
                        <div class="swiper-button-next">
                          <i class="fa-solid fa-chevron-right" style="
                          color: white;
                          background-color: black;
                          height: auto;
                          font-size: x-large;
                          position: absolute;
                          left: 10px;
                          width: 100%;
                          text-align: center;
                          "></i>
                        </div>
                        <div class="swiper-button-prev">
                          <i class="fa-solid fa-chevron-left" style="
                          color: white;
                          background-color: black;
                          height: auto;
                          font-size: x-large;
                          position: absolute;
                          right: 10px;
                          width: 100%;
                          text-align: center;
                          "></i>
                        </div>
                        <div class="swiper-pagination"></div>
                    </div>                    
                    <!-- <div class="stock">
                        <span>S&P 500</span>
                        <span id="header_US500_price">
                            <script>
                                // get data from the func "getData"
                                getStock("US500","Index","NYSE").then( res => {
                                    // if the api is not connected, show the error msg
                                    let data = res.message === "Network Error" ? "<%- theme.stock.apiErrMsg%>"  : res;
                                    // show the blockhigh
                                    document.getElementById("header_US500_price").innerHTML = data;
                                });
                            </script>
                        </span> -->

                        <!-- <i id="header_US500_gain_img" class="fa-solid text-darken-3 "></i> 
                        <span id="header_US500_gain_text" class="text-darken-3"> 
                            <span id="header_US500_gain">
                                <script>
                                    // get data from the func "getData"
                                    getStockGain("US500","Index","NYSE").then( res => {
                                        // if the api is not connected, show the error msg
                                        let data = res.message === "Network Error" ? "<%- theme.stock.apiErrMsg%>"  : res;
                                        // show the blockhigh
                                        setPriceGain("header_US500_gain_img", "header_US500_gain_text", "header_US500_gain", parseFloat(data));
                                    });
                                </script>
                            </span>
                        </span> -->
                    <!-- </div> -->
                    
                </div>
            </div>
        </div>
        <%- partial('_partial/navigation') %>
        <%- partial('_partial/slider') %>

        <% if (theme.githubLink && theme.githubLink.enable) { %>
            <%- partial('_partial/github-link') %>
                <% } %>
    </nav>

</header>
